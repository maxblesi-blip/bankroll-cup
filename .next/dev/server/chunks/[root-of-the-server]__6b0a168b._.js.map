{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/M%C3%A4%C3%A4%C3%A4x/bankroll-cup/app/api/check-discord-membership/route.ts"],"sourcesContent":["// app/api/check-discord-membership/route.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\n\r\nconst DISCORD_BOT_TOKEN = process.env.DISCORD_BOT_TOKEN;\r\nconst DISCORD_GUILD_ID = process.env.DISCORD_GUILD_ID;\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    let discordUserId = body.discordUserId;\r\n\r\n    // Debug Logging\r\n    console.log(\"=== Discord Membership Check ===\");\r\n    console.log(\"Request body:\", body);\r\n    console.log(\"DISCORD_BOT_TOKEN set?\", !!DISCORD_BOT_TOKEN);\r\n    console.log(\"DISCORD_GUILD_ID:\", DISCORD_GUILD_ID);\r\n    console.log(\"Discord User ID:\", discordUserId);\r\n\r\n    // Validierung 1: Guild ID\r\n    if (!DISCORD_GUILD_ID) {\r\n      console.error(\"❌ DISCORD_GUILD_ID nicht gesetzt!\");\r\n      return NextResponse.json(\r\n        {\r\n          error: \"❌ Server Konfiguration fehlt: DISCORD_GUILD_ID nicht in .env.local gesetzt\",\r\n          isMember: false,\r\n          hint: 'Bitte setze \"DISCORD_GUILD_ID\" in .env.local und starte den Server neu',\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Validierung 2: Bot Token\r\n    if (!DISCORD_BOT_TOKEN) {\r\n      console.error(\"❌ DISCORD_BOT_TOKEN nicht gesetzt!\");\r\n      return NextResponse.json(\r\n        {\r\n          error: \"❌ Server Konfiguration fehlt: DISCORD_BOT_TOKEN nicht in .env.local gesetzt\",\r\n          isMember: false,\r\n          hint: 'Bitte setze \"DISCORD_BOT_TOKEN\" in .env.local und starte den Server neu',\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Validierung 3: User ID\r\n    if (!discordUserId) {\r\n      console.error(\"❌ Discord User ID nicht vorhanden!\");\r\n      console.error(\"Request Body war:\", body);\r\n      return NextResponse.json(\r\n        {\r\n          error: \"❌ Discord User ID erforderlich\",\r\n          isMember: false,\r\n          hint: \"Die Discord User ID konnte nicht aus der Session extrahiert werden\",\r\n          receivedData: body,\r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    console.log(`✓ Überprüfe: User ${discordUserId} im Guild ${DISCORD_GUILD_ID}`);\r\n\r\n    // Überprüfe ob User auf dem Discord Server ist\r\n    const response = await fetch(\r\n      `https://discord.com/api/v10/guilds/${DISCORD_GUILD_ID}/members/${discordUserId}`,\r\n      {\r\n        method: \"GET\",\r\n        headers: {\r\n          Authorization: `Bot ${DISCORD_BOT_TOKEN}`,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      }\r\n    );\r\n\r\n    console.log(`Discord API Response Status: ${response.status}`);\r\n\r\n    // Status 200 -> User ist auf dem Server ✓\r\n    if (response.ok) {\r\n      const memberData = await response.json();\r\n      console.log(`✓ User ${discordUserId} ist Mitglied des Servers`);\r\n\r\n      return NextResponse.json({\r\n        isMember: true,\r\n        nickname: memberData.nick || memberData.user?.username || \"Member\",\r\n        joinedAt: memberData.joined_at,\r\n        roles: memberData.roles || [],\r\n      });\r\n    }\r\n\r\n    // Status 404 -> User ist NICHT auf dem Server ✗\r\n    if (response.status === 404) {\r\n      console.log(`✗ User ${discordUserId} ist NICHT Mitglied des Servers`);\r\n\r\n      return NextResponse.json({\r\n        isMember: false,\r\n        message: \"Benutzer ist nicht auf dem Discord Server\",\r\n      });\r\n    }\r\n\r\n    // Andere Fehler\r\n    const errorText = await response.text();\r\n    console.error(\r\n      `❌ Discord API Error ${response.status}:`,\r\n      errorText\r\n    );\r\n\r\n    return NextResponse.json(\r\n      {\r\n        error: `Discord API Error: ${response.status} ${response.statusText}`,\r\n        isMember: false,\r\n        details: errorText,\r\n      },\r\n      { status: response.status }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"❌ Unerwarteter Fehler:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        error: \"Fehler beim Überprüfen der Discord Mitgliedschaft\",\r\n        isMember: false,\r\n        details: error instanceof Error ? error.message : \"Unbekannter Fehler\",\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"AAAA,4CAA4C;;;;;AAC5C;;AAEA,MAAM,oBAAoB,QAAQ,GAAG,CAAC,iBAAiB;AACvD,MAAM,mBAAmB,QAAQ,GAAG,CAAC,gBAAgB;AAE9C,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,IAAI,gBAAgB,KAAK,aAAa;QAEtC,gBAAgB;QAChB,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,iBAAiB;QAC7B,QAAQ,GAAG,CAAC,0BAA0B,CAAC,CAAC;QACxC,QAAQ,GAAG,CAAC,qBAAqB;QACjC,QAAQ,GAAG,CAAC,oBAAoB;QAEhC,0BAA0B;QAC1B,IAAI,CAAC,kBAAkB;YACrB,QAAQ,KAAK,CAAC;YACd,OAAO,mKAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,UAAU;gBACV,MAAM;YACR,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,IAAI,CAAC,mBAAmB;YACtB,QAAQ,KAAK,CAAC;YACd,OAAO,mKAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,UAAU;gBACV,MAAM;YACR,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,yBAAyB;QACzB,IAAI,CAAC,eAAe;YAClB,QAAQ,KAAK,CAAC;YACd,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,mKAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,UAAU;gBACV,MAAM;gBACN,cAAc;YAChB,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,CAAC,kBAAkB,EAAE,cAAc,UAAU,EAAE,kBAAkB;QAE7E,+CAA+C;QAC/C,MAAM,WAAW,MAAM,MACrB,CAAC,mCAAmC,EAAE,iBAAiB,SAAS,EAAE,eAAe,EACjF;YACE,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,IAAI,EAAE,mBAAmB;gBACzC,gBAAgB;YAClB;QACF;QAGF,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,SAAS,MAAM,EAAE;QAE7D,0CAA0C;QAC1C,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,aAAa,MAAM,SAAS,IAAI;YACtC,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,cAAc,yBAAyB,CAAC;YAE9D,OAAO,mKAAY,CAAC,IAAI,CAAC;gBACvB,UAAU;gBACV,UAAU,WAAW,IAAI,IAAI,WAAW,IAAI,EAAE,YAAY;gBAC1D,UAAU,WAAW,SAAS;gBAC9B,OAAO,WAAW,KAAK,IAAI,EAAE;YAC/B;QACF;QAEA,gDAAgD;QAChD,IAAI,SAAS,MAAM,KAAK,KAAK;YAC3B,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,cAAc,+BAA+B,CAAC;YAEpE,OAAO,mKAAY,CAAC,IAAI,CAAC;gBACvB,UAAU;gBACV,SAAS;YACX;QACF;QAEA,gBAAgB;QAChB,MAAM,YAAY,MAAM,SAAS,IAAI;QACrC,QAAQ,KAAK,CACX,CAAC,oBAAoB,EAAE,SAAS,MAAM,CAAC,CAAC,CAAC,EACzC;QAGF,OAAO,mKAAY,CAAC,IAAI,CACtB;YACE,OAAO,CAAC,mBAAmB,EAAE,SAAS,MAAM,CAAC,CAAC,EAAE,SAAS,UAAU,EAAE;YACrE,UAAU;YACV,SAAS;QACX,GACA;YAAE,QAAQ,SAAS,MAAM;QAAC;IAE9B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,mKAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,UAAU;YACV,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}